# AICS Volume Viewer

This is a WebGL canvas-based volume viewer. It can display multichannel volume data of 8-bit intensity values.
Volume data is provided to the core 3d viewer in two parts.  The first part is via a json object containing dimensions and other metadata.  The second part is the volume data itself, delivered to the viewer in one of two formats: texture atlases (png files containing volume slices tiled across the 2d image), or raw Uint8Arrays of 3d volume data (one Uint8Array per channel).

# API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [AICSvolumeLoader](#aicsvolumeloader)
    -   [loadVolumeAtlasData](#loadvolumeatlasdata)
        -   [Parameters](#parameters)
        -   [Examples](#examples)
-   [AICSmakeVolumes](#aicsmakevolumes)
    -   [createVolume](#createvolume)
        -   [Parameters](#parameters-1)
    -   [createSphere](#createsphere)
        -   [Parameters](#parameters-2)
    -   [createCylinder](#createcylinder)
        -   [Parameters](#parameters-3)
    -   [createTorus](#createtorus)
        -   [Parameters](#parameters-4)
    -   [createCone](#createcone)
        -   [Parameters](#parameters-5)
-   [AICSview3d](#aicsview3d)
    -   [Parameters](#parameters-6)
    -   [redraw](#redraw)
    -   [setImage](#setimage)
        -   [Parameters](#parameters-7)
    -   [setCameraMode](#setcameramode)
        -   [Parameters](#parameters-8)
    -   [setAutoRotate](#setautorotate)
        -   [Parameters](#parameters-9)
    -   [resize](#resize)
        -   [Parameters](#parameters-10)
-   [PerChannelCallback](#perchannelcallback)
    -   [Parameters](#parameters-11)
-   [AICSvolumeDrawable](#aicsvolumedrawable)
    -   [Parameters](#parameters-12)
    -   [setAxisClip](#setaxisclip)
        -   [Parameters](#parameters-13)
    -   [updateIsovalue](#updateisovalue)
        -   [Parameters](#parameters-14)
    -   [getIsovalue](#getisovalue)
        -   [Parameters](#parameters-15)
    -   [updateOpacity](#updateopacity)
        -   [Parameters](#parameters-16)
    -   [hasIsosurface](#hasisosurface)
        -   [Parameters](#parameters-17)
    -   [createIsosurface](#createisosurface)
        -   [Parameters](#parameters-18)
    -   [channelNames](#channelnames)
    -   [saveChannelIsosurface](#savechannelisosurface)
        -   [Parameters](#parameters-19)
    -   [setVolumeChannelEnabled](#setvolumechannelenabled)
        -   [Parameters](#parameters-20)
    -   [updateChannelColor](#updatechannelcolor)
        -   [Parameters](#parameters-21)
    -   [setDensity](#setdensity)
        -   [Parameters](#parameters-22)
    -   [setBrightness](#setbrightness)
        -   [Parameters](#parameters-23)
    -   [setChannelDataFromAtlas](#setchanneldatafromatlas)
        -   [Parameters](#parameters-24)
    -   [setChannelDataFromVolume](#setchanneldatafromvolume)
        -   [Parameters](#parameters-25)
    -   [appendEmptyChannel](#appendemptychannel)
        -   [Parameters](#parameters-26)
    -   [setChannelAsMask](#setchannelasmask)
        -   [Parameters](#parameters-27)
-   [imageInfo](#imageinfo)
    -   [Properties](#properties)
    -   [Examples](#examples-1)

## AICSvolumeLoader

### loadVolumeAtlasData

load per-channel volume data from a batch of image files containing the volume slices tiled across the images

#### Parameters

-   `imageArray` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;{name: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String), channels: [Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>}>** 
-   `callback` **[PerChannelCallback](#perchannelcallback)** Per-channel callback.  Called when each channel's atlased volume data is loaded

#### Examples

```javascript
loadVolumeAtlasData([{
    "name": "AICS-10_5_5.ome.tif_atlas_0.png",
    "channels": [0, 1, 2]
}, {
    "name": "AICS-10_5_5.ome.tif_atlas_1.png",
    "channels": [3, 4, 5]
}, {
    "name": "AICS-10_5_5.ome.tif_atlas_2.png",
    "channels": [6, 7, 8]
}], mycallback);
```

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String), [Image](https://developer.mozilla.org/docs/Web/API/HTMLImageElement/Image)>** a map(imageurl : Image object) that should be used to cancel the download requests,
for example if you need to destroy the image before all data has arrived.
as requests arrive, the callback will be called per image, not per channel

## AICSmakeVolumes

Basic utility functions to create sample volume data

### createVolume

Rasterize a signed distance function into a volume of vx _ vy _ vz dimensions. This is a binary filling operation.

#### Parameters

-   `vx` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `vy` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `vz` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `sdFunc` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)** A function f(x,y,z) that returns a distance. f &lt; 0 will be the interior of the volume, and f>=0 will be outside.

### createSphere

Create a volume filled with a sphere in the center

#### Parameters

-   `vx` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `vy` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `vz` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `radius` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

### createCylinder

Create a volume with a cylinder centered inside.

#### Parameters

-   `vx` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `vy` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `vz` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `hx` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** width of cap (?)
-   `hy` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** depth of cap (?)

### createTorus

Create a volume with a torus centered inside

#### Parameters

-   `vx` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `vy` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `vz` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `tx` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** inner radius
-   `ty` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** outer radius

### createCone

Create a volume with a cone centered inside.  cx, cy must be a 2d normalized pair...?

#### Parameters

-   `vx` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `vy` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `vz` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `cx` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** base radius
-   `cy` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** height

## AICSview3d

### Parameters

-   `parentElement` **[HTMLElement](https://developer.mozilla.org/docs/Web/HTML/Element)** the 3d display will try to fill the parent element.

### redraw

Force a redraw.  This is generally not needed because of constant redraws in the main animation loop.

### setImage

Add a new volume image to the viewer.  The viewer currently only supports a single image at a time, and will destroy any prior existing image.

#### Parameters

-   `img` **[AICSvolumeDrawable](#aicsvolumedrawable)** 

### setCameraMode

Change the camera projection to look along an axis, or to view in a 3d perspective camera.

#### Parameters

-   `mode` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Mode can be "3D", or "XY" or "Z", or "YZ" or "X, or "XZ" or "Y".  3D is a perspective view, and all the others are orthographic projections

### setAutoRotate

Enable or disable a turntable rotation mode. The display will continuously spin about the vertical screen axis.

#### Parameters

-   `autorotate` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** 

### resize

Notify the view that it has been resized.  This will automatically be connected to the window when the AICSview3d is created.

#### Parameters

-   `comp` **[HTMLElement](https://developer.mozilla.org/docs/Web/HTML/Element)?** Ignored.
-   `w` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Width, or parent element's offsetWidth if not specified.
-   `h` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Height, or parent element's offsetHeight if not specified.
-   `ow` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Ignored.
-   `oh` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Ignored.
-   `eOpts` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)?** Ignored.

## PerChannelCallback

Type: [Function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)

### Parameters

-   `imageurl` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `channelindex` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `atlasdata` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)** 
-   `atlaswidth` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `atlasheight` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

## AICSvolumeDrawable

A renderable multichannel volume image with 8-bits per channel intensity values.

### Parameters

-   `imageInfo` **[imageInfo](#imageinfo)** 

### setAxisClip

#### Parameters

-   `axis` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 0, 1, or 2 for x, y, or z axis
-   `minval` **any** 
-   `maxval` **any** 
-   `isOrthoAxis` **any** 

### updateIsovalue

If an isosurface exists, update its isovalue and regenerate the surface. Otherwise do nothing.

#### Parameters

-   `channel` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `value` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

### getIsovalue

#### Parameters

-   `channel` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** the isovalue for this channel or undefined if this channel does not have an isosurface created

### updateOpacity

Set opacity for isosurface

#### Parameters

-   `channel` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `value` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Opacity

### hasIsosurface

#### Parameters

-   `channel` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

Returns **any** true if there is currently a mesh isosurface for this channel

### createIsosurface

If an isosurface is not already created, then create one.  Otherwise do nothing.

#### Parameters

-   `channel` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `value` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** isovalue
-   `alpha` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Opacity
-   `transp` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?** render surface as transparent object

### channelNames

Returns **any** a reference to the list of channel names

### saveChannelIsosurface

Save a channel's isosurface as a triangle mesh to either STL or GLTF2 format.  File will be named automatically, using image name and channel name.

#### Parameters

-   `channelIndex` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `type` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Either 'GLTF' or 'STL'

### setVolumeChannelEnabled

Hide or display volume data for a channel

#### Parameters

-   `channelIndex` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `enabled` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** 

### updateChannelColor

Set the color for a channel

#### Parameters

-   `channelIndex` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `colorrgba` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>** [r,g,b]

### setDensity

Set the global density of the volume data

#### Parameters

-   `density` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Roughly equivalent to opacity, or how translucent or opaque the volume is
-   `no_redraw` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?** Set to true to delay re-rendering. Otherwise ignore.

### setBrightness

Set the global brightness of the volume data

#### Parameters

-   `brightness` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Roughly speaking, an intensity multiplier on the whole volume
-   `no_redraw` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?** Set to true to delay re-rendering. Otherwise ignore.

### setChannelDataFromAtlas

Assign volume data via a 2d array containing the z slices as tiles across it.  Assumes that the incoming data is consistent with the image's pre-existing imageInfo tile metadata.

#### Parameters

-   `channelIndex` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `atlasdata` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)** 
-   `atlaswidth` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `atlasheight` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

### setChannelDataFromVolume

Assign volume data as a 3d array ordered x,y,z. The xy size must be equal to tilewidth\*tileheight from the imageInfo used to construct this AICSvolumeDrawable.  Assumes that the incoming data is consistent with the image's pre-existing imageInfo tile metadata.

#### Parameters

-   `channelIndex` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `volumeData` **[Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array)** 

### appendEmptyChannel

Add a new channel ready to receive data from one of the setChannelDataFrom\* calls.
Name and color will be defaulted if not provided. For now, leave imageInfo alone as the "original" data

#### Parameters

-   `name` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `color` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>** [r,g,b]

### setChannelAsMask

Assign a channel index as a mask channel (will multiply its color against the entire visible volume)

#### Parameters

-   `channelIndex` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

## imageInfo

Provide dimensions of the volume data, including dimensions for texture atlas data in which the volume z slices
are tiled across a single large 2d image plane.

Type: [Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)

### Properties

-   `name` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Base name of image
-   `version` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** schema version preferably in semver format.
-   `width` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Width of original volumetric data prior to downsampling
-   `height` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Height of original volumetric data prior to downsampling
-   `channels` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Number of channels
-   `tiles` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Number of tiles, which must be equal to the number of z-slices in original volumetric data
-   `pixel_size_x` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Size of pixel in volumetric data to be rendered, in x-dimension, unitless
-   `pixel_size_y` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Size of pixel in volumetric data to be rendered, in y-dimension, unitless
-   `pixel_size_z` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Size of pixel in volumetric data to be rendered, in z-dimension, unitless
-   `channel_names` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** Names of each of the channels to be rendered, in order. Unique identifier expected
-   `rows` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Number of rows in tile array in each image.  Note tiles &lt;= rows\*cols
-   `cols` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Number of columns in tile array in each image.  Note tiles &lt;= rows\*cols
-   `tile_width` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Width of each tile in volumetric dataset to be rendered, in pixels
-   `tile_height` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Height of each tile in volumetric dataset to be rendered, in pixels
-   `atlas_width` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Total width of image containing all the tiles, in pixels.  Note atlas_width === cols\*tile_width
-   `atlas_height` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Total height of image containing all the tiles, in pixels. Note atlas_height === rows\*tile_height

### Examples

```javascript
let imgdata = {
"width": 306,
"height": 494,
"channels": 9,
"channel_names": ["DRAQ5", "EGFP", "Hoechst 33258", "TL Brightfield", "SEG_STRUCT", "SEG_Memb", "SEG_DNA", "CON_Memb", "CON_DNA"],
"rows": 7,
"cols": 10,
"tiles": 65,
"tile_width": 204,
"tile_height": 292,
// for webgl reasons, it is best for atlas_width and atlas_height to be <= 2048 
// and ideally a power of 2.  This generally implies downsampling the original volume data for display in this viewer.
"atlas_width": 2040,
"atlas_height": 2044,
"pixel_size_x": 0.065,
"pixel_size_y": 0.065,
"pixel_size_z": 0.29,
"name": "AICS-10_5_5",
"status": "OK",
"version": "0.0.0",
"aicsImageVersion": "0.3.0"
};
```

# Acknowledgements

The volume shader itself is a heavily modified version of one that has its origins in [Bisque](http://bioimage.ucsb.edu/bisque).

## BisQue license

Center for Bio-Image Informatics, University of California at Santa Barbara

Copyright (c) 2007-2017 by the Regents of the University of California
All rights reserved

Redistribution and use in source and binary forms, in whole or in parts, with or without
modification, are permitted provided that the following conditions are met:

    Redistributions of source code must retain the above copyright
    notice, this list of conditions, and the following disclaimer.

    Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions, and the following disclaimer in
    the documentation and/or other materials provided with the
    distribution.

    Use or redistribution must display the attribution with the logo
    or project name and the project URL link in a location commonly
    visible by the end users, unless specifically permitted by the
    license holders.

THIS SOFTWARE IS PROVIDED BY THE REGENTS OF THE UNIVERSITY OF CALIFORNIA ''AS IS'' AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE REGENTS OF THE UNIVERSITY OF CALIFORNIA OR
CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

The views and conclusions contained in the software and documentation
are those of the authors and should not be interpreted as representing
official policies, either expressed or implied, of the Regents of the University of California.
